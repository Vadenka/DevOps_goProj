name: CI/CD Pipeline

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # Шаг 1: Клонирование репозитория в CI/CD
      - name: Checkout code
        uses: actions/checkout@v3

      # Шаг 2: Сборка Docker образа и запуск контейнеров
      - name: Build and run Docker containers
        run: |
          docker-compose up -d --build
          sleep 10  # Даем время для инициализации контейнеров

      # Шаг 3: Проверка работы контейнеров
      - name: Check Docker containers
        run: docker ps -a

      # Шаг 4: Тестирование работы API
      - name: Ping API
        run: curl -X GET http://localhost:6003/

      # Шаг 5: Отправка данных в базу через POST-запрос
      - name: Post data to API
        run: |
          curl -X POST http://localhost:6003/ -d "phrase=New phrase from CI/CD!"
